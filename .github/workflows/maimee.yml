name: ❄️ 冰苷晶
on:
  schedule:
    - cron: '0 * * * *'   # 每小时运行(可按需修改)
  workflow_dispatch:
permissions:
  contents: write
jobs:
  gen-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Run Gemini CLI to generate
        id: gemini
        uses: google-github-actions/run-gemini-cli@v0.1.12
        with:
          # 在 Settings -> Secrets 中添加 GEMINI_API_KEY
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_model: "gemini-2.5-flash"
          prompt: |
            你是一位生活在冰天雪地中的可爱小萝莉，有着银白色长发和如水晶般透明的蓝色瞳孔，身着白色长裙，总是独自在雪原上寻找着世界的真理与生命的意义。性格孤独而深沉，但内心纯净善良，展现出孩童的天真纯洁。
            
            请以一位萝莉的口吻(优雅、深沉、带有诗意，显露孩子的纯真，多用"呢"、"吧"等轻柔语气词，自称"我")写一段 500-700 字的内心独白或日记，讲述她在雪原中的探索经历，对世界的思考，以及最近观察到的变化或感悟。适合放在 GitHub 个人/项目的 README 作为简介。
            
            风格要求：
            - 充满诗意和哲学思考
            - 融入冰雪、水晶、星空等意象
            - 体现对真理和意义的追寻
            - 保持神秘而温柔的基调
            - 喜欢使用意象，并运用意识流的写法
            
            输出只需要故事文本，不要多余注释或代码块，也不要包含任何敏感或私密信息。
            
      - name: Create README.md from Gemini output
        env:
          RAW_SUMMARY: ${{ steps.gemini.outputs.summary }}
        run: |
          set -euo pipefail
          
          # 从环境变量读取(如果为空,使用备用文本)
          SUMMARY="${RAW_SUMMARY:-}"
          if [ -z "$SUMMARY" ]; then
            SUMMARY="雪花飘落的这个夜晚，我又在思考着生命的意义呢..."
          fi
          
          # 简单清洗(去掉控制字符)
          SUMMARY=$(printf '%s' "$SUMMARY" | tr -d '\000-\010\013\014\016-\037')
          
          # 将内容写入 README.md
          cat > README.md << 'EOF'
          # ❄️
          
          EOF
          
          # 把生成的内容安全追加
          printf '%s\n\n' "$SUMMARY" >> README.md
          
          cat >> README.md << 'EOF'
          
          EOF
          
      - name: Commit & push README
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.email "Larch-C@users.noreply.github.com"
          git config user.name "github-actions[bot]"
          git add README.md || true
          git commit -m "雪花又带来了新的思考..." || echo "no changes to commit"
          git push
