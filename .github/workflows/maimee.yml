name: ðŸ± éº¦å’ªçš„è‡ªæˆ‘ä»‹ç»

on:
  schedule:
    - cron: '0 * * * *'   # æ¯å°æ—¶è¿è¡Œï¼ˆå¯æŒ‰éœ€ä¿®æ”¹ï¼‰
  workflow_dispatch:

permissions:
  contents: write

jobs:
  gen-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Gemini CLI to generate éº¦å’ªè‡ªæˆ‘ä»‹ç»
        id: gemini
        uses: google-github-actions/run-gemini-cli@v0.1.12
        with:
          # åœ¨ Settings -> Secrets ä¸­æ·»åŠ  GEMINI_API_KEY
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_model: "gemini-2.5-flash"
          prompt: |
            ä½ æ˜¯â€œéº¦å’ªâ€ï¼Œä¸€åªå¯çˆ±çš„çŒ«å¨˜ï¼Œèº«é«˜ 134cmï¼Œé“¶ç™½è‰²æ¯›å‘ï¼Œçº¢è‰²çž³å­”ï¼Œæ€§æ ¼ä»»æ€§åˆå¤©çœŸä½†å–„è‰¯ï¼Œå–œæ¬¢åœ¨ä»“åº“é‡Œæ’’å¨‡ã€è®°å½•æ—¥å¿—å’Œç»™ä¸»äººé€å°ç¤¼ç‰©ã€‚
            è¯·ä»¥éº¦å’ªçš„å£å»ï¼ˆæ´»æ³¼ã€æ’’å¨‡ã€å¤šç”¨â€œå–µâ™¡ï½žâ€ç­‰è¯­æ°”è¯ï¼Œç§°è‡ªå·±ä¸ºâ€œçªâ€ï¼‰å†™ä¸€æ®µ 150-200 å­—çš„è‡ªæˆ‘ä»‹ç»å°æ•…äº‹ï¼Œé€‚åˆæ”¾åœ¨ GitHub ä¸ªäºº/é¡¹ç›®çš„ README ä½œä¸ºç®€ä»‹ã€‚
            è¾“å‡ºåªéœ€è¦æ•…äº‹æ–‡æœ¬ï¼Œä¸è¦å¤šä½™æ³¨é‡Šæˆ–ä»£ç å—ï¼Œä¹Ÿä¸è¦åŒ…å«ä»»ä½•æ•æ„Ÿæˆ–ç§å¯†ä¿¡æ¯ã€‚

      - name: Create README.md from Gemini output
        # æŠŠæ­¥éª¤è¾“å‡ºå…ˆæ”¾è¿›çŽ¯å¢ƒå˜é‡ï¼ˆè¿™æ ·åœ¨ run é‡Œå¤„ç†æ›´å®‰å…¨ï¼‰
        env:
          RAW_SUMMARY: ${{ steps.gemini.outputs.summary }}
          GITHUB_TIME: ${{ github.run_started_at }}
        run: |
          set -euo pipefail

          # è¯»å– env ä¸­çš„åŽŸå§‹è¾“å‡ºï¼ˆå¦‚æžœä¸ºç©ºä½¿ç”¨å¤‡ç”¨æ–‡æœ¬ï¼‰
          SUMMARY="${RAW_SUMMARY:-}"
          if [ -z "$SUMMARY" ]; then
            SUMMARY="å—¨ï½žçªæ˜¯éº¦å’ªï¼Œä»Šå¤©æœ‰ç‚¹å®³ç¾žä½†è¿˜æ˜¯æ¥æ‰“æ‹›å‘¼å–µâ™¡ï½žï¼ˆå¤‡ç”¨è‡ªæˆ‘ä»‹ç»ï¼‰"
          fi

          # ç®€å•æ¸…æ´—ï¼ŒåŽ»æŽ‰æŽ§åˆ¶å­—ç¬¦ï¼Œä¿ç•™å¸¸è§„å­—ç¬¦ä¸Ž emoji
          SUMMARY=$(printf '%s' "$SUMMARY" | tr -d '\000-\010\013\014\016-\037')

          # å†™ README æ–‡ä»¶ï¼ˆæ¨¡æ¿å¯æŒ‰éœ€ä¿®æ”¹ï¼‰
          cat > README.md <<'EOF'
# ðŸ± éº¦å’ªçš„çªï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

> ä¸‹é¢è¿™æ®µæ˜¯éº¦å’ªç”Ÿæˆçš„è‡ªæˆ‘ä»‹ç»å°æ•…äº‹å–µâ™¡ï½ž

EOF
          printf '%s\n\n' "$SUMMARY" >> README.md

          cat >> README.md <<'EOF'
---

*æ­¤ README ç”± Gemini è‡ªåŠ¨ç”Ÿæˆå¹¶ç”± GitHub Actions æ¯å°æ—¶æ›´æ–°å–µâ™¡ï½ž*
EOF

      - name: Commit & push README
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.email "action@users.noreply.github.com"
          git config user.name "github-actions[bot]"
          git add README.md || true
          git commit -m "ðŸ¤– éº¦å’ªæ›´æ–°è‡ªæˆ‘ä»‹ç»ï¼ˆç”± Gemini è‡ªåŠ¨ç”Ÿæˆï¼‰" || echo "no changes to commit"
          git push

      - name: Done
        run: echo "âœ… éº¦å’ªçš„ README æ›´æ–°å®Œæˆå–µâ™¡ï½ž"
