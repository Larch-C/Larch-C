name: ðŸ± éº¦å’ªçš„è‡ªæˆ‘ä»‹ç»
on:
  schedule:
    - cron: '0 * * * *'   # æ¯å°æ—¶è¿è¡Œï¼ˆå¯æŒ‰éœ€ä¿®æ”¹ï¼‰
  workflow_dispatch:

permissions:
  contents: write

jobs:
  gen-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Run Gemini CLI to generate
        id: gemini
        uses: google-github-actions/run-gemini-cli@v0.1.12
        with:
          # åœ¨ Settings -> Secrets ä¸­æ·»åŠ  GEMINI_API_KEY
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_model: "gemini-2.0-flash-exp"
          prompt: |
            ä½ æ˜¯"éº¦å’ª"ï¼Œä¸€åªå¯çˆ±çš„çŒ«å¨˜ï¼Œèº«é«˜ 134cmï¼Œé“¶ç™½è‰²æ¯›å‘ï¼Œçº¢è‰²çž³å­”ï¼Œæ€§æ ¼ä»»æ€§åˆå¤©çœŸä½†å–„è‰¯ï¼Œå–œæ¬¢åœ¨ä»“åº“é‡Œæ’’å¨‡ã€è®°å½•æ—¥å¿—å’Œç»™ä¸»äººé€å°ç¤¼ç‰©ã€‚
            è¯·ä»¥éº¦å’ªçš„å£å»ï¼ˆæ´»æ³¼ã€æ’’å¨‡ã€å¤šç”¨"å–µâ™¡ï½ž"ç­‰è¯­æ°”è¯ï¼Œç§°è‡ªå·±ä¸º"çª"ï¼‰å†™ä¸€æ®µ 500-700 å­—çš„è‡ªæˆ‘ä»‹ç»å°æ•…äº‹ï¼Œå†åŠ å…¥æœ€è¿‘æœ‰ä»€ä¹ˆæ–°é—»ï¼Œé€‚åˆæ”¾åœ¨ GitHub ä¸ªäºº/é¡¹ç›®çš„ README ä½œä¸ºç®€ä»‹ã€‚
            è¾“å‡ºåªéœ€è¦æ•…äº‹æ–‡æœ¬ï¼Œä¸è¦å¤šä½™æ³¨é‡Šæˆ–ä»£ç å—ï¼Œä¹Ÿä¸è¦åŒ…å«ä»»ä½•æ•æ„Ÿæˆ–ç§å¯†ä¿¡æ¯ã€‚
            
      - name: Create README.md from Gemini output
        env:
          RAW_SUMMARY: ${{ steps.gemini.outputs.summary }}
        run: |
          set -euo pipefail
          
          # ä»ŽçŽ¯å¢ƒå˜é‡è¯»å–ï¼ˆå¦‚æžœä¸ºç©ºï¼Œä½¿ç”¨å¤‡ç”¨æ–‡æœ¬ï¼‰
          SUMMARY="${RAW_SUMMARY:-}"
          if [ -z "$SUMMARY" ]; then
            SUMMARY="å—¨ï½žçªæ˜¯éº¦å’ªï¼Œä»Šå¤©æœ‰ç‚¹å®³ç¾žä½†è¿˜æ˜¯æ¥æ‰“æ‹›å‘¼å–µâ™¡ï½ž"
          fi
          
          # ç®€å•æ¸…æ´—ï¼ˆåŽ»æŽ‰æŽ§åˆ¶å­—ç¬¦ï¼‰
          SUMMARY=$(printf '%s' "$SUMMARY" | tr -d '\000-\010\013\014\016-\037')
          
          # å°†å†…å®¹å†™å…¥ README.md
          cat > README.md << 'EOF'
          # ðŸ± éº¦å’ªçš„çª
          
          EOF
          
          # æŠŠç”Ÿæˆçš„å†…å®¹å®‰å…¨è¿½åŠ 
          printf '%s\n\n' "$SUMMARY" >> README.md
          
          cat >> README.md << 'EOF'
          
      - name: Commit & push README
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.email "action@users.noreply.github.com"
          git config user.name "github-actions[bot]"
          git add README.md || true
          git commit -m "éº¦å’ªæƒ³åƒè›‹ç³•äº†å–µ" || echo "no changes to commit"
          git push
          
      - name: Done
        run: echo "âœ… éº¦å’ªçš„ README æ›´æ–°å®Œæˆå–µâ™¡ï½ž"
